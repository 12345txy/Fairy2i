
# PhaseQuant 量化方法解析 (iFairy 框架)

`PhaseQuant` 是 iFairy 框架中针对复数神经网络（Complex-Valued Neural Networks, CVNNs）提出的一种高效、无乘法器的相位量化方法。其核心思想是将复数权重 `w` 的相位角 `θ` 量化到四个基本值 `{+1, +i, -1, -i}` 之一，仅用2比特即可表示。

## 核心思想

对于一个复数权重 $w = r \\cdot e^{i\\theta}$，其中 $r$ 是幅值，$ \\theta $ 是相位角，PhaseQuant 方法专注于对**相位 $ \\theta $** 进行量化。

它将复数平面划分为四个沿对角线分布的扇区（如下图所示），每个扇区对应一个量化目标值。

  - 当 $w$ 的相位角落在右侧扇区时，它被量化为 `+1`。
  - 当 $w$ 的相位角落在上侧扇区时，它被量化为 `+i`。
  - 当 $w$ 的相位角落在左侧扇区时，它被量化为 `-1`。
  - 当 $w$ 的相位角落在下侧扇区时，它被量化为 `-i`。

## 数学公式

PhaseQuant 的量化函数 $\\mathcal{P}(w)$ 可以用一个简洁的数学公式来表示：

$$\mathcal{P}(w) = i^k$$

其中，指数 $k$ 的计算方式如下：

$$k = \left\lfloor \frac{2\theta}{\pi} + \frac{1}{2} \right\rfloor$$

这里：

  - $w$ 是待量化的复数权重。
  - $\\theta = \\text{Arg}(w) \\in (-\\pi, \\pi]$ 是 $w$ 的主辐角（相位角），单位为弧度。
  - $\\lfloor \\cdot \\rfloor$ 是**向下取整函数** (Floor Function)。
  - `i` 是虚数单位，满足 $i^2 = -1$。

### 量化映射关系

根据上述公式，我们可以得出相位角范围与最终量化值的映射关系：

| 相位角范围 (θ) | 指数 $k$ 的计算 | 指数 $k$ 的值 | 量化结果 $\\mathcal{P}(w) = i^k$ |
| :--- | :--- | :-: | :--- |
| $\\theta \\in [-\\pi/4, \\pi/4)$ | $\\lfloor [-0.5, 0.5) + 0.5 \\rfloor = \\lfloor [0, 1) \\rfloor$ | 0 | $i^0 = +1$ |
| $\\theta \\in [\\pi/4, 3\\pi/4)$ | $\\lfloor [0.5, 1.5) + 0.5 \\rfloor = \\lfloor [1, 2) \\rfloor$ | 1 | $i^1 = +i$ |
| $\\theta \\in [3\\pi/4, \\pi] \\cup (-\\pi, -3\\pi/4)$ | $\\lfloor [1.5, 2] \\cup (-2, -1.5) + 0.5 \\rfloor$ | 2 或 -2 | $i^2 = i^{-2} = -1$ |
| $\\theta \\in [-3\\pi/4, -\\pi/4)$ | $\\lfloor [-1.5, -0.5) + 0.5 \\rfloor = \\lfloor [-1, 0) \\rfloor$ | -1 | $i^{-1} = -i$ |

*注意：对于左侧扇区，角度跨越了 $\\pi$ 和 $-\\pi$ 的边界，但计算出的 $k$ 值模4后等价于2，最终都指向 `-1`。*

## 量化过程详解 (Step-by-Step)

让我们以您图片中给出的例子来验证这个过程：

**当 $\\theta = \\text{Arg}(w) \\in [-\\pi/4, \\pi/4]$ 时：**

1.  **计算指数 $ k $**:
    因为 $\\theta$ 的范围是 $ [-\\pi/4, \\pi/4] $，所以 $\\frac{2\\theta}{\\pi}$ 的范围是 $ [-1/2, 1/2] $。
    代入公式：
    $k = \\left\\lfloor \\frac{2\\theta}{\\pi} + \\frac{1}{2} \\right\\rfloor$
    $k$ 的计算范围是 $ \\lfloor [-1/2, 1/2] + 1/2 \\rfloor = \\lfloor [0, 1] \\rfloor $。
    由于 $k$ 必须是整数，所以在这个区间内向下取整的结果是 **0**。

2.  **计算最终量化值**:
    $\\mathcal{P}(w) = i^k = i^0 = +1$

这与图中右侧扇区被量化为 `+1` 的结果完全一致。其他三个扇区也可以通过同样的方式进行推导。

## 方法优势

1.  **无乘法器 (Multiplier-Free)**：量化后的值为 `{+1, +i, -1, -i}`。一个复数乘以这些值，仅仅对应于交换实部和虚部、取反等简单操作，而不需要任何硬件乘法器，计算效率极高。
2.  **极低位宽 (Low Bit-width)**：仅用2个比特就可以存储4个状态，极大地压缩了模型大小。
3.  **性能优越**：实验证明，该方法能够在大幅压缩模型的同时，保持复数神经网络的高精度。

-----